<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <title>User's Meals</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@100;300;700&display=swap" rel="stylesheet">
    <link th:href="@{/css/meal-list.css}" rel="stylesheet">
</head>
<body>
    <div class="page-container">
        <div class="sidebar">
            <form th:action="@{meals/createMealForm}" method="POST">
                <input type="hidden" th:name="userId" th:value="${user.id}">
                <input class="logout-btn" type="submit" value="Add Meal" />
            </form>
            <form action="#" th:action="@{/logout}" method="POST">
                <input class="logout-btn" type="submit" value="Logout" />
            </form>
        </div>
        <script th:inline="javascript">
            let classname = "";
            let elements = null;
            let color = null;
        </script>
        <div class="main-content-container">
            <div class="main-content-title" th:text="'Welcome back, ' + ${user.firstName} +'.'">Welcome back, User.</div>
            <div class="main-content-card-container">
                <div class="card-container" th:each="meal, stat : ${mealList}" th:if="${not #lists.isEmpty(mealList)}">
                    <div class="card-title-container">
                        <div class="card-title" th:text="${meal.name}">Meal Name</div>
                        <form method="post" class="hide-submit" th:action="@{/meals/updateMealForm}" th:object="${mealList[__${stat.index}__]}">
                            <input type="hidden"  th:name="mealId" th:value="${mealList[__${stat.index}__].id}">
                            <label>
                                <input type="submit">
                                <svg class="card-edit-btn" fill="none" width="27" style="-webkit-print-color-adjust:exact"
                                    id="screenshot-9287ecd1-15dd-80a4-8003-f79eb65c26d4" version="1.1"
                                    viewBox="619 307 27 27" height="27">
                                    <g id="shape-9287ecd1-15dd-80a4-8003-f79eb65c26d4">
                                        <g class="fills" id="fills-9287ecd1-15dd-80a4-8003-f79eb65c26d4">
                                            <path class="card-edit-btn" rx="0" ry="0" style="fill:#e9ecef;fill-opacity:1"
                                                d="M623.917,328.600C623.985,328.600,624.052,328.593,624.120,328.583L629.797,327.587C629.864,327.574,629.928,327.544,629.975,327.493L644.282,313.186C644.345,313.123,644.381,313.038,644.381,312.948C644.381,312.859,644.345,312.774,644.282,312.711L638.673,307.098C638.609,307.034,638.524,307.000,638.433,307.000C638.342,307.000,638.258,307.034,638.194,307.098L623.887,321.405C623.836,321.455,623.806,321.516,623.792,321.583L622.797,327.260C622.730,327.627,622.849,328.003,623.114,328.266C623.337,328.482,623.617,328.600,623.917,328.600ZZM626.192,322.714L638.433,310.476L640.907,312.950L628.666,325.188L625.666,325.718L626.192,322.714ZZM644.920,331.435L620.080,331.435C619.483,331.435,619.000,331.918,619.000,332.515L619.000,333.730C619.000,333.878,619.122,334.000,619.270,334.000L645.730,334.000C645.878,334.000,646.000,333.878,646.000,333.730L646.000,332.515C646.000,331.918,645.517,331.435,644.920,331.435ZZ">
                                            </path>
                                        </g>
                                    </g>
                                </svg>
                            </label>
                        </form>
                    </div>
                    <div class="card-sub-container">
                        <div class="card-sub-title">kcal</div>
                        <div class="progress-bar" th:classappend="'meal' + ${meal.id}" role="progressbar"
                            aria-valuenow="60" aria-valuemin="0" aria-valuemax="100"
                            style="background: radial-gradient(closest-side, #212529 79%, transparent 80% 100%), conic-gradient(hotpink 50%, #E9ECEF 0); ">
                            <progress value="75" min="0" max="100"
                                style="visibility:hidden;height:0;width:0;">75%</progress>
                        </div>
                    </div>
                    <div class="card-sub-container">
                        <div class="card-sub-title">protein</div>
                        <div class="progress-bar" th:classappend="'meal'+${meal.id}" role="progressbar"
                            aria-valuenow="60" aria-valuemin="0" aria-valuemax="100"
                            style="background: radial-gradient(closest-side, #212529 79%, transparent 80% 100%), conic-gradient(green 50%, #E9ECEF 0); ">
                            <progress value="75" min="0" max="100" style="visibility:hidden;height:0;width:0;">
                            </progress>
                        </div>
                    </div>
                    <div class="card-sub-container">
                        <div class="card-sub-title">carbs</div>
                        <div class="progress-bar" th:classappend="'meal' + ${meal.id}" role="progressbar"
                            aria-valuenow="60" aria-valuemin="0" aria-valuemax="100"
                            style="background: radial-gradient(closest-side, #212529 79%, transparent 80% 100%), conic-gradient(blue 50%, #E9ECEF 0); ">
                            <progress value="75" min="0" max="100"
                                style="visibility:hidden;height:0;width:0;">75%</progress>
                        </div>
                    </div>
                    <div class="card-sub-container">
                        <div class="card-sub-title">fat</div>
                        <div class="progress-bar" th:classappend="'meal' + ${meal.id}" role="progressbar"
                            aria-valuenow="60" aria-valuemin="0" aria-valuemax="100"
                            style="background: radial-gradient(closest-side, #212529 79%, transparent 80% 100%), conic-gradient(red 50%, #E9ECEF 0); ">
                            <progress value="75" min="0" max="100"
                                style="visibility:hidden;height:0;width:0;">75%</progress>
                        </div>
                    </div>
                    <script th:inline="javascript">
                        /*<![CDATA[*/
                            classname = 'meal' + /*[[${meal.id}]]*/ 1;
                            elements = document.getElementsByClassName(classname);
                            for (let i = 0; i < 4; i++) {
                                let element = elements[i];
                                let progress = 0;
                                if (i == 0) {
                                    let calGoal = /*[[${meal.caloriesGoal}]]*/;
                                    if(calGoal != 0) {
                                        let currCals = /*[[${meal.calories}]]*/;
                                        progress = currCals / calGoal;
                                    }
                                    color = "hotpink";
                                } else if (i == 1) {
                                    let proteinGoal = /*[[${meal.proteinGoal}]]*/;
                                    if(proteinGoal != 0) {
                                        let currProtein = /*[[${meal.protein}]]*/;
                                        progress = currProtein / proteinGoal;
                                    }
                                    color = "#40C057";
                                } else if (i == 2) {
                                    let carbsGoal = /*[[${meal.carbsGoal}]]*/;
                                    if(carbsGoal != 0) {
                                        let currCarbs = /*[[${meal.carbs}]]*/;
                                        progress = currCarbs / carbsGoal;
                                    }
                                    color = "#339AF0";
                                } else if (i == 3) {
                                    let fatGoal = /*[[${meal.fatGoal}]]*/;
                                    if(fatGoal != 0) {
                                        let currFat = /*[[${meal.fat}]]*/;
                                        progress = currFat / fatGoal;
                                    }
                                    color = "#FA5252";
                                } else {
                                    color = "yellow"
                                    progress = 1;
                                }
                                element.style = `background: radial-gradient(closest-side, #212529 79%, transparent 80% 100%), conic-gradient(${color} ${progress * 100 + ''}%, #E9ECEF 0); `
                            }
                        /*]]>*/
                    </script>
                </div>
            </div>
        </div>
        <div class="grocery-list-container">
            <div class="list-bg">
                <div class="list-title">Grocery List</div>
                <div class="list-container">
                    <div class="food-container">
                        <div class="food-title sub-food-container">Basmati Rice</div>
                        <div class="food-amount sub-food-container">3000 g</div>
                        <svg class="edit-btn" fill="none" width="14" style="-webkit-print-color-adjust:exact"
                            id="screenshot-9287ecd1-15dd-80a4-8003-f79e8b9033db" version="1.1"
                            viewBox="1811.5 315 14 14" height="14">
                            <g id="shape-9287ecd1-15dd-80a4-8003-f79e8b9033db">
                                <g class="fills" id="fills-9287ecd1-15dd-80a4-8003-f79e8b9033db">
                                    <path rx="0" ry="0" style="fill:#e9ecef;fill-opacity:1"
                                        d="M1814.050,326.200C1814.085,326.200,1814.120,326.197,1814.155,326.191L1817.098,325.675C1817.133,325.668,1817.166,325.652,1817.191,325.626L1824.609,318.208C1824.642,318.175,1824.660,318.131,1824.660,318.084C1824.660,318.038,1824.642,317.994,1824.609,317.961L1821.701,315.051C1821.668,315.017,1821.624,315.000,1821.577,315.000C1821.529,315.000,1821.485,315.017,1821.452,315.051L1814.034,322.469C1814.008,322.495,1813.992,322.527,1813.985,322.562L1813.469,325.505C1813.434,325.696,1813.496,325.891,1813.633,326.027C1813.749,326.139,1813.894,326.200,1814.050,326.200ZZM1815.229,323.148L1821.577,316.802L1822.859,318.085L1816.512,324.431L1814.956,324.706L1815.229,323.148ZZM1824.940,327.670L1812.060,327.670C1811.750,327.670,1811.500,327.920,1811.500,328.230L1811.500,328.860C1811.500,328.937,1811.563,329.000,1811.640,329.000L1825.360,329.000C1825.437,329.000,1825.500,328.937,1825.500,328.860L1825.500,328.230C1825.500,327.920,1825.250,327.670,1824.940,327.670ZZ">
                                    </path>
                                </g>
                            </g>
                        </svg>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- <h3 class="mt-5 mx-3"><span th:text="${user.firstName}"></span>'s Meals</h3>
    <hr>
    <div class="container">
        <form th:action="@{meals/createMealForm}" method="POST">
            <input type="hidden" th:name="userId" th:value="${user.id}">
            <button type="submit" class="btn btn-primary btn-sm mb-3" id="btn-add">Add Meal</button>
        </form>
        <div class="table-border-custom">
        <table class="table table-striped">
            <thead>
            <tr>
                <th>Name</th>
                <th>Calories (kcal)</th>
                <th>Protein (g)</th>
                <th>Carbs (g)</th>
                <th>Fat (g)</th>
                <th>Action</th>
            </tr>
            </thead>
            <tbody class="table-hover">
            <tr th:each="meal, stat : ${mealList}" th:if="${not #lists.isEmpty(mealList)}">
                <td th:text="${meal.name}"></td>
                <td th:text="${meal.calories}"></td>
                <td th:text="${meal.protein}"></td>
                <td th:text="${meal.carbs}"></td>
                <td th:text="${meal.fat}"></td>
                <td>
                    <div class="d-flex flew-row">
                        <div class="p-2">
                            <form method="post" th:action="@{/meals/updateMealForm}" th:object="${mealList[__${stat.index}__]}">
                                <input type="hidden" th:name="mealId" th:value="${mealList[__${stat.index}__].id}">
                                <input type="submit" value="Update" class="btn btn-info btn-sm">
                            </form>
                        </div>
                        <div class="p-2">
                            <form method="post" th:action="@{/meals/delete}" th:object="${mealList[__${stat.index}__]}">
                                <input type="hidden" th:name="id" th:value="${mealList[__${stat.index}__].id}">
                                <input type="submit" onclick="if (!(confirm('Are you sure you want to delete this meal?'))) return false"
                                       value="Delete" class="btn btn-danger btn-sm">
                            </form>
                        </div>
                    </div>
                </td>
            </tr>
            </tbody>
        </table>
        <form action="#" th:action="@{/logout}" method="POST">
            <input type="submit" value="Logout" />
        </form>
    </div> -->
</body>

</html>